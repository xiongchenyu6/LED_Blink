#include "chinese_font_16x16.h"
#include "ssd1306.h"

// External cursor position functions
extern void ssd1306_SetCursor(uint8_t x, uint8_t y);

// Chinese characters 16x16 font data
// Each character is 16x16 pixels = 32 bytes (2 bytes per row)
const uint8_t ChineseFont16x16[] = {
    // 我 (wo) - "I/me" - GB2312: CED2
    0x04, 0x80,  // .....1.. 1.......
    0x0E, 0xA0,  // ....111. 1.1.....
    0x78, 0x90,  // .1111... 1..1....
    0x08, 0x90,  // ....1... 1..1....
    0x08, 0x84,  // ....1... 1....1..
    0xFF, 0xFE,  // 11111111 1111111.
    0x08, 0x80,  // ....1... 1.......
    0x08, 0x90,  // ....1... 1..1....
    0x0A, 0x90,  // ....1.1. 1..1....
    0x0C, 0x60,  // ....11.. .11.....
    0x18, 0x40,  // ...11... .1......
    0x68, 0xA0,  // .11.1... 1.1.....
    0x09, 0x20,  // ....1..1 ..1.....
    0x0A, 0x14,  // ....1.1. ...1.1..
    0x28, 0x14,  // ..1.1... ...1.1..
    0x10, 0x0C,  // ...1.... ....11..
    
    // 爱 (ai) - "love" - GB2312: B0AE
    0x00, 0x78,  // ........ .1111...
    0x3F, 0x80,  // ..111111 1.......
    0x11, 0x10,  // ...1...1 ...1....
    0x09, 0x20,  // ....1..1 ..1.....
    0x7F, 0xFE,  // .1111111 1111111.
    0x42, 0x02,  // .1....1. ......1.
    0x82, 0x04,  // 1.....1. .....1..
    0x7F, 0xF8,  // .1111111 11111...
    0x04, 0x00,  // .....1.. ........
    0x07, 0xF0,  // .....111 1111....
    0x0A, 0x20,  // ....1.1. ..1.....
    0x09, 0x40,  // ....1..1 .1......
    0x10, 0x80,  // ...1.... 1.......
    0x11, 0x60,  // ...1...1 .11.....
    0x22, 0x1C,  // ..1...1. ...111..
    0x0C, 0x08,  // ....11.. ....1...
    
    // 郭 (guo) - surname Guo - GB2312: B9F9
    0x08, 0x00,  // ....1... ........
    0x04, 0x7C,  // .....1.. .11111..
    0xFF, 0xC4,  // 11111111 11...1..
    0x00, 0x44,  // ........ .1...1..
    0x3F, 0x48,  // ..111111 .1..1...
    0x21, 0x48,  // ..1....1 .1..1...
    0x21, 0x50,  // ..1....1 .1.1....
    0x3F, 0x48,  // ..111111 .1..1...
    0x00, 0x44,  // ........ .1...1..
    0x7F, 0x42,  // .1111111 .1....1.
    0x02, 0x42,  // ......1. .1....1.
    0x04, 0x62,  // .....1.. .11...1.
    0xFF, 0x54,  // 11111111 .1.1.1..
    0x04, 0x48,  // .....1.. .1..1...
    0x14, 0x40,  // ...1.1.. .1......
    0x08, 0x40,  // ....1... .1......
    
    // 芷 (zhi) - fragrant plant - GB2312: DCC6
    0x04, 0x40,  // .....1.. .1......
    0x04, 0x44,  // .....1.. .1...1..
    0xFF, 0xFE,  // 11111111 1111111.
    0x04, 0x40,  // .....1.. .1......
    0x05, 0x40,  // .....1.1 .1......
    0x01, 0x00,  // .......1 ........
    0x09, 0x00,  // ....1..1 ........
    0x09, 0x10,  // ....1..1 ...1....
    0x09, 0xF8,  // ....1..1 11111...
    0x09, 0x00,  // ....1..1 ........
    0x09, 0x00,  // ....1..1 ........
    0x09, 0x00,  // ....1..1 ........
    0x09, 0x00,  // ....1..1 ........
    0x09, 0x04,  // ....1..1 .....1..
    0xFF, 0xFE,  // 11111111 1111111.
    0x00, 0x00,  // ........ ........
    
    // 慧 (hui) - wisdom - GB2312: BBDB
    0x08, 0x20,  // ....1... ..1.....
    0x7E, 0xFC,  // .111111. 111111..
    0x08, 0x20,  // ....1... ..1.....
    0x3E, 0xF8,  // ..11111. 11111...
    0x08, 0x20,  // ....1... ..1.....
    0x7E, 0xFC,  // .111111. 111111..
    0x08, 0x20,  // ....1... ..1.....
    0x3F, 0xF8,  // ..111111 11111...
    0x00, 0x08,  // ........ ....1...
    0xFF, 0xFE,  // 11111111 1111111.
    0x00, 0x08,  // ........ ....1...
    0x3F, 0xF8,  // ..111111 11111...
    0x09, 0x00,  // ....1..1 ........
    0x28, 0xA8,  // ..1.1... 1.1.1...
    0x48, 0x24,  // .1..1... ..1..1..
    0x07, 0xE0,  // .....111 111.....
};

FontDef Font_Chinese_16x16 = {
    16,  // Width
    16,  // Height  
    (const uint16_t*)ChineseFont16x16
};

// Function to write a Chinese character at current cursor position
void ssd1306_WriteChineseChar(uint8_t index, uint8_t color) {
    if (index > 4) return;  // Only 5 characters defined
    
    static uint8_t currentX = 0;
    static uint8_t currentY = 0;
    static uint8_t initialized = 0;
    
    // Get initial cursor position from main code
    if (!initialized) {
        currentX = 14;  // Starting X position
        currentY = 24;  // Starting Y position
        initialized = 1;
    }
    
    // Check if there's enough space on the display
    if (currentX + 16 > 128) {
        return;
    }
    
    const uint8_t *charData = ChineseFont16x16 + (index * 32);  // 32 bytes per character
    
    // Draw the character pixel by pixel
    for (uint8_t row = 0; row < 16; row++) {
        uint16_t rowData = (charData[row * 2] << 8) | charData[row * 2 + 1];
        
        for (uint8_t col = 0; col < 16; col++) {
            if (rowData & (0x8000 >> col)) {
                ssd1306_DrawPixel(currentX + col, currentY + row, color);
            }
        }
    }
    
    // Move cursor for next character
    currentX += 18;  // 16 width + 2 spacing
}