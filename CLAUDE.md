# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is an STM32F103C8T6 microcontroller project that implements:
- LED control functionality
- SSD1306 OLED display driver (128x64 pixels)
- USB CDC (Communications Device Class) for virtual serial port communication
- I2C communication for the OLED display

## Build Commands

```bash
# Configure the project (run from project root)
cmake -B build -DCMAKE_BUILD_TYPE=Debug

# Build the project
cmake --build build

# Generate binary file (automatically done post-build)
# Creates LED_Blink.bin from LED_Blink.elf
```

## Project Architecture

### Build System
- **CMake-based**: Main `CMakeLists.txt` orchestrates the build
- **STM32CubeMX Integration**: `cmake/stm32cubemx/CMakeLists.txt` handles HAL driver compilation
- **Toolchain**: ARM GCC (`arm-none-eabi-gcc`) configured in `cmake/gcc-arm-none-eabi.cmake`
- **Linker Script**: `STM32F103XX_FLASH.ld` defines memory layout

### Code Structure
- **Core/**: Application code generated by STM32CubeMX
  - `Core/Src/main.c`: Main application entry point
  - `Core/Src/i2c.c`: I2C peripheral initialization
  - `Core/Src/gpio.c`: GPIO initialization (including LED pin)
  - `Core/Src/ssd1306.c`: OLED display driver implementation
- **Drivers/**: STM32 HAL and CMSIS drivers
- **USB_DEVICE/**: USB CDC implementation for virtual COM port
- **Middlewares/**: ST USB device library

### Key Components
1. **MCU**: STM32F103C8T6 (Cortex-M3, 64KB Flash, 20KB RAM)
2. **Peripherals**:
   - I2C1: Connected to SSD1306 OLED display (PB8=SCL, PB9=SDA)
   - USB: Full-speed device for CDC communication
   - GPIO: PC13 (LED), PA1 (additional output)
3. **Display**: SSD1306 128x64 OLED via I2C (address 0x3C)

### Important Configuration
- **HAL Configuration**: `Core/Inc/stm32f1xx_hal_conf.h`
- **MCU Definition**: `STM32F103xB` preprocessor macro
- **Clock**: External oscillator on PD0/PD1
- **Debug**: SWD interface on PA13/PA14

## Development Notes

### Adding New Source Files
Add to either:
- Main `CMakeLists.txt` in the `file(GLOB SOURCES ...)` section for application code
- `cmake/stm32cubemx/CMakeLists.txt` for driver-related code

### Memory Constraints
With only 20KB RAM and 64KB Flash, optimize for size (`-Os` flag in Release builds).

### USB CDC Communication
The USB CDC interface creates a virtual COM port. Use `CDC_Transmit_FS()` from `usbd_cdc_if.h` to send data to the host.

### OLED Display Usage
```c
ssd1306_Init();
ssd1306_Fill(SSD1306_COLOR_BLACK);
ssd1306_SetCursor(0, 0);
ssd1306_WriteString("Hello", Font_11x18, SSD1306_COLOR_WHITE);
ssd1306_UpdateScreen();
```